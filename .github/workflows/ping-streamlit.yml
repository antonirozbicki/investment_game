name: Ping Streamlit app

on:
  schedule:
    - cron: "0 7 * * *"  # codziennie 07:00 UTC
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Streamlit app (no redirects)
        shell: bash
        run: |
          set -e

          URL="https://investmentgame.streamlit.app/"
          echo "Pinging: $URL"

          # HEAD request bez podążania za redirectami (to klucz)
          # -I = head, bez pobierania treści
          # --max-time = limit czasu
          code=$(curl -sS -I --max-time 60 -o /dev/null -w "%{http_code}" "$URL" || echo "000")

          echo "HTTP: $code"

          # Sukces jeśli serwer odpowiada (cokolwiek < 500)
          # 000 oznacza brak odpowiedzi / timeout / błąd sieci
          if [[ "$code" == "000" ]]; then
            echo "No response (timeout/network error)"
            exit 1
          fi

          if (( code >= 500 )); then
            echo "Server error $code"
            exit 1
          fi

          echo "Ping OK (response $code)"
