name: Ping Streamlit app

on:
  # Automatyczny ping raz dziennie
  schedule:
    - cron: "0 7 * * *"   # codziennie 07:00 UTC
  # Możliwość ręcznego uruchomienia z GitHub Actions
  workflow_dispatch: {}

jobs:
  ping:
    runs-on: ubuntu-latest

    steps:
      - name: Ping Streamlit app
        run: |
          set -e

          URL="https://investmentgame.streamlit.app/"
          echo "Pinging Streamlit app: $URL"

          # Ping z:
          # - sensownym User-Agent (żeby nie wyglądać jak bot)
          # - obsługą redirectów
          # - limitem redirectów (żeby nie było pętli)
          # - dużym timeoutem (na „budzenie” appki)
          curl -sS -L \
            --max-redirs 10 \
            -A "Mozilla/5.0 (GitHub Actions ping; investmentgame)" \
            --connect-timeout 20 \
            --max-time 180 \
            --retry 3 \
            --retry-all-errors \
            -o /dev/null \
            -w "HTTP %{http_code}\nFINAL_URL %{url_effective}\n" \
            "$URL"
